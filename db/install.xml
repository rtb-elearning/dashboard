<?xml version="1.0" encoding="UTF-8" ?>
<XMLDB PATH="local/elby_dashboard/db" VERSION="20260213" COMMENT="XMLDB file for Moodle local/elby_dashboard"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="../../../lib/xmldb/xmldb.xsd"
>
  <TABLES>
    <TABLE NAME="elby_schools" COMMENT="Cached school metadata from SDMS API">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="school_code" TYPE="char" LENGTH="50" NOTNULL="true" SEQUENCE="false" COMMENT="SDMS schoolCode identifier"/>
        <FIELD NAME="region_code" TYPE="char" LENGTH="50" NOTNULL="false" SEQUENCE="false" COMMENT="SDMS regionCode encoding province/district/sector"/>
        <FIELD NAME="school_name" TYPE="char" LENGTH="255" NOTNULL="true" DEFAULT="" SEQUENCE="false" COMMENT="SDMS schoolName"/>
        <FIELD NAME="is_active" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="1" SEQUENCE="false" COMMENT="1=ACTIVE, 0=inactive"/>
        <FIELD NAME="school_status" TYPE="char" LENGTH="50" NOTNULL="false" SEQUENCE="false" COMMENT="Public, Government Aided, etc."/>
        <FIELD NAME="school_category" TYPE="char" LENGTH="50" NOTNULL="false" SEQUENCE="false" COMMENT="SDMS schoolCategory"/>
        <FIELD NAME="academic_year" TYPE="char" LENGTH="20" NOTNULL="false" SEQUENCE="false" COMMENT="e.g. 2025/2026"/>
        <FIELD NAME="gps_long" TYPE="number" LENGTH="10" NOTNULL="false" SEQUENCE="false" DECIMALS="6"/>
        <FIELD NAME="gps_lat" TYPE="number" LENGTH="10" NOTNULL="false" SEQUENCE="false" DECIMALS="6"/>
        <FIELD NAME="establishment_date" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Unix timestamp"/>
        <FIELD NAME="has_tvet" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="1 if school has TVET level"/>
        <FIELD NAME="sync_status" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="1=synced, 0=error"/>
        <FIELD NAME="sync_error" TYPE="text" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="last_synced" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Unix timestamp"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="uq_school_code" UNIQUE="true" FIELDS="school_code"/>
        <INDEX NAME="idx_region_code" UNIQUE="false" FIELDS="region_code"/>
      </INDEXES>
    </TABLE>

    <TABLE NAME="elby_levels" COMMENT="School education levels from SDMS (PPR, PR, OL, AL, TVET)">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="schoolid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="FK to elby_schools.id"/>
        <FIELD NAME="sdms_level_id" TYPE="char" LENGTH="10" NOTNULL="true" DEFAULT="" SEQUENCE="false" COMMENT="SDMS levelId (0,1,2,3,5)"/>
        <FIELD NAME="level_name" TYPE="char" LENGTH="50" NOTNULL="true" DEFAULT="" SEQUENCE="false" COMMENT="PPR, PR, OL, AL, TVET"/>
        <FIELD NAME="level_desc" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="SDMS level description"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_schoolid" TYPE="foreign" FIELDS="schoolid" REFTABLE="elby_schools" REFFIELDS="id"/>
        <KEY NAME="uq_school_level" TYPE="unique" FIELDS="schoolid, sdms_level_id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="idx_schoolid" UNIQUE="false" FIELDS="schoolid"/>
        <INDEX NAME="idx_level_name" UNIQUE="false" FIELDS="level_name"/>
      </INDEXES>
    </TABLE>

    <TABLE NAME="elby_combinations" COMMENT="Programs/trades within a level (e.g. NIT, SOD, MCE under TVET)">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="levelid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="FK to elby_levels.id"/>
        <FIELD NAME="combination_code" TYPE="char" LENGTH="50" NOTNULL="true" DEFAULT="" SEQUENCE="false" COMMENT="SDMS combinationCode (e.g. 574, 541)"/>
        <FIELD NAME="combination_name" TYPE="char" LENGTH="50" NOTNULL="true" DEFAULT="" SEQUENCE="false" COMMENT="Short name (NIT, SOD)"/>
        <FIELD NAME="combination_desc" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="Full program name (e.g. Software Development)"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_levelid" TYPE="foreign" FIELDS="levelid" REFTABLE="elby_levels" REFFIELDS="id"/>
        <KEY NAME="uq_level_combo" TYPE="unique" FIELDS="levelid, combination_code"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="idx_levelid" UNIQUE="false" FIELDS="levelid"/>
        <INDEX NAME="idx_combination_code" UNIQUE="false" FIELDS="combination_code"/>
      </INDEXES>
    </TABLE>

    <TABLE NAME="elby_grades" COMMENT="Year/level grades within a combination (e.g. Level 3, Level 4, SENIOR 5)">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="combinationid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="FK to elby_combinations.id"/>
        <FIELD NAME="grade_code" TYPE="char" LENGTH="50" NOTNULL="true" DEFAULT="" SEQUENCE="false" COMMENT="SDMS gradeCode (e.g. 5503, 5504)"/>
        <FIELD NAME="grade_name" TYPE="char" LENGTH="100" NOTNULL="true" DEFAULT="" SEQUENCE="false" COMMENT="Level 3, Level 4, SENIOR 5, etc."/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_combinationid" TYPE="foreign" FIELDS="combinationid" REFTABLE="elby_combinations" REFFIELDS="id"/>
        <KEY NAME="uq_combo_grade" TYPE="unique" FIELDS="combinationid, grade_code"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="idx_combinationid" UNIQUE="false" FIELDS="combinationid"/>
      </INDEXES>
    </TABLE>

    <TABLE NAME="elby_classgroups" COMMENT="Class sections within a grade (e.g. LEVEL3 NIT, S5MCE)">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="gradeid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="FK to elby_grades.id"/>
        <FIELD NAME="sdms_class_id" TYPE="char" LENGTH="100" NOTNULL="true" SEQUENCE="false" COMMENT="SDMS classGroupId (UUID)"/>
        <FIELD NAME="class_name" TYPE="char" LENGTH="100" NOTNULL="true" DEFAULT="" SEQUENCE="false" COMMENT="SDMS classGroupName"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_gradeid" TYPE="foreign" FIELDS="gradeid" REFTABLE="elby_grades" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="uq_sdms_class_id" UNIQUE="true" FIELDS="sdms_class_id"/>
        <INDEX NAME="idx_gradeid" UNIQUE="false" FIELDS="gradeid"/>
      </INDEXES>
    </TABLE>

    <TABLE NAME="elby_sdms_users" COMMENT="Links Moodle users to SDMS records (base table for students and teachers)">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="FK to mdl_user.id"/>
        <FIELD NAME="sdms_id" TYPE="char" LENGTH="50" NOTNULL="true" SEQUENCE="false" COMMENT="studentNumber or staffId from SDMS"/>
        <FIELD NAME="schoolid" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="FK to elby_schools.id"/>
        <FIELD NAME="user_type" TYPE="char" LENGTH="20" NOTNULL="true" DEFAULT="" SEQUENCE="false" COMMENT="student, teacher, admin, headmaster"/>
        <FIELD NAME="academic_year" TYPE="char" LENGTH="20" NOTNULL="false" SEQUENCE="false" COMMENT="e.g. 2025/2026"/>
        <FIELD NAME="sdms_status" TYPE="char" LENGTH="50" NOTNULL="false" SEQUENCE="false" COMMENT="CONTINUING, INACTIVE, etc."/>
        <FIELD NAME="sync_status" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="1=synced, 0=error"/>
        <FIELD NAME="sync_error" TYPE="text" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="last_synced" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Unix timestamp"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_userid" TYPE="foreign-unique" FIELDS="userid" REFTABLE="user" REFFIELDS="id"/>
        <KEY NAME="fk_schoolid" TYPE="foreign" FIELDS="schoolid" REFTABLE="elby_schools" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="uq_sdms_id" UNIQUE="true" FIELDS="sdms_id"/>
        <INDEX NAME="idx_user_type" UNIQUE="false" FIELDS="user_type"/>
        <INDEX NAME="idx_schoolid" UNIQUE="false" FIELDS="schoolid"/>
        <INDEX NAME="idx_sdms_status" UNIQUE="false" FIELDS="sdms_status"/>
      </INDEXES>
    </TABLE>

    <TABLE NAME="elby_students" COMMENT="Student-specific SDMS data, linked to elby_sdms_users">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="sdms_userid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="FK to elby_sdms_users.id"/>
        <FIELD NAME="classid" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="FK to elby_classgroups.id"/>
        <FIELD NAME="program" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="Combination description from SDMS"/>
        <FIELD NAME="program_code" TYPE="char" LENGTH="50" NOTNULL="false" SEQUENCE="false" COMMENT="combinationCode from SDMS"/>
        <FIELD NAME="registration_date" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Unix timestamp of SDMS registrationDate"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_sdms_userid" TYPE="foreign-unique" FIELDS="sdms_userid" REFTABLE="elby_sdms_users" REFFIELDS="id"/>
        <KEY NAME="fk_classid" TYPE="foreign" FIELDS="classid" REFTABLE="elby_classgroups" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="idx_classid" UNIQUE="false" FIELDS="classid"/>
        <INDEX NAME="idx_program_code" UNIQUE="false" FIELDS="program_code"/>
      </INDEXES>
    </TABLE>

    <TABLE NAME="elby_teachers" COMMENT="Teacher-specific SDMS data, linked to elby_sdms_users">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="sdms_userid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="FK to elby_sdms_users.id"/>
        <FIELD NAME="position" TYPE="char" LENGTH="100" NOTNULL="false" SEQUENCE="false" COMMENT="e.g. Class Teacher, Head of Department"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_sdms_userid" TYPE="foreign-unique" FIELDS="sdms_userid" REFTABLE="elby_sdms_users" REFFIELDS="id"/>
      </KEYS>
    </TABLE>

    <TABLE NAME="elby_staff_subjects" COMMENT="Teacher subject/speciality assignments from SDMS">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="teacherid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="FK to elby_teachers.id"/>
        <FIELD NAME="level_id" TYPE="char" LENGTH="10" NOTNULL="true" DEFAULT="" SEQUENCE="false" COMMENT="SDMS levelId"/>
        <FIELD NAME="level_name" TYPE="char" LENGTH="50" NOTNULL="true" DEFAULT="" SEQUENCE="false" COMMENT="e.g. TVET"/>
        <FIELD NAME="combination_code" TYPE="char" LENGTH="50" NOTNULL="true" DEFAULT="" SEQUENCE="false" COMMENT="SDMS combinationCode"/>
        <FIELD NAME="combination_name" TYPE="char" LENGTH="255" NOTNULL="true" DEFAULT="" SEQUENCE="false" COMMENT="e.g. Software Development"/>
        <FIELD NAME="subject_code" TYPE="char" LENGTH="50" NOTNULL="true" DEFAULT="" SEQUENCE="false" COMMENT="SDMS subjectCode e.g. SWDWD301"/>
        <FIELD NAME="subject_name" TYPE="char" LENGTH="255" NOTNULL="true" DEFAULT="" SEQUENCE="false" COMMENT="e.g. Website Development"/>
        <FIELD NAME="grade_code" TYPE="char" LENGTH="50" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="grade_name" TYPE="char" LENGTH="100" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="class_group" TYPE="char" LENGTH="100" NOTNULL="false" SEQUENCE="false" COMMENT="SDMS classGroup name"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_teacherid" TYPE="foreign" FIELDS="teacherid" REFTABLE="elby_teachers" REFFIELDS="id"/>
        <KEY NAME="uq_teacher_subject" TYPE="unique" FIELDS="teacherid, subject_code"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="idx_teacherid" UNIQUE="false" FIELDS="teacherid"/>
        <INDEX NAME="idx_level_name" UNIQUE="false" FIELDS="level_name"/>
        <INDEX NAME="idx_combination_code" UNIQUE="false" FIELDS="combination_code"/>
      </INDEXES>
    </TABLE>

    <TABLE NAME="elby_user_metrics" COMMENT="Pre-computed activity metrics per user per course per period">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="FK to mdl_user.id"/>
        <FIELD NAME="courseid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="FK to mdl_course.id"/>
        <FIELD NAME="period_start" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Unix timestamp"/>
        <FIELD NAME="period_end" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Unix timestamp"/>
        <FIELD NAME="period_type" TYPE="char" LENGTH="20" NOTNULL="true" DEFAULT="weekly" SEQUENCE="false" COMMENT="weekly (default), monthly"/>
        <FIELD NAME="total_actions" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="active_days" TYPE="int" LENGTH="3" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="first_access" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="last_access" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="time_spent_seconds" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="resources_viewed" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="resources_unique" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="videos_started" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="videos_completed" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="pages_viewed" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="files_downloaded" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="forum_views" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="forum_posts" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="forum_replies" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="chat_messages" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="assignments_viewed" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="assignments_submitted" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="assignments_graded" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="assignments_avg_score" TYPE="number" LENGTH="5" NOTNULL="false" SEQUENCE="false" DECIMALS="2"/>
        <FIELD NAME="quizzes_attempted" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="quizzes_completed" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="quizzes_avg_score" TYPE="number" LENGTH="5" NOTNULL="false" SEQUENCE="false" DECIMALS="2"/>
        <FIELD NAME="quizzes_avg_duration" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Seconds"/>
        <FIELD NAME="activities_completed" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="activities_total" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="course_progress" TYPE="number" LENGTH="5" NOTNULL="false" SEQUENCE="false" DECIMALS="2" COMMENT="0-100 percentage"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_userid" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id"/>
        <KEY NAME="fk_courseid" TYPE="foreign" FIELDS="courseid" REFTABLE="course" REFFIELDS="id"/>
        <KEY NAME="uq_user_course_period" TYPE="unique" FIELDS="userid, courseid, period_start, period_type"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="idx_userid" UNIQUE="false" FIELDS="userid"/>
        <INDEX NAME="idx_courseid" UNIQUE="false" FIELDS="courseid"/>
        <INDEX NAME="idx_period_start" UNIQUE="false" FIELDS="period_start"/>
      </INDEXES>
    </TABLE>

    <TABLE NAME="elby_school_metrics" COMMENT="Aggregated school-level metrics for reporting">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="schoolid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="FK to elby_schools.id"/>
        <FIELD NAME="courseid" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="FK to mdl_course.id, 0 = school-wide aggregate"/>
        <FIELD NAME="period_start" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Unix timestamp"/>
        <FIELD NAME="period_end" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Unix timestamp"/>
        <FIELD NAME="period_type" TYPE="char" LENGTH="20" NOTNULL="true" DEFAULT="weekly" SEQUENCE="false" COMMENT="weekly, monthly"/>
        <FIELD NAME="total_enrolled" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="total_active" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="total_inactive" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="new_enrollments" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="avg_actions_per_student" TYPE="number" LENGTH="10" NOTNULL="false" SEQUENCE="false" DECIMALS="2"/>
        <FIELD NAME="avg_active_days" TYPE="number" LENGTH="5" NOTNULL="false" SEQUENCE="false" DECIMALS="2"/>
        <FIELD NAME="avg_time_spent_minutes" TYPE="number" LENGTH="10" NOTNULL="false" SEQUENCE="false" DECIMALS="2"/>
        <FIELD NAME="total_resource_views" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="avg_resources_per_student" TYPE="number" LENGTH="10" NOTNULL="false" SEQUENCE="false" DECIMALS="2"/>
        <FIELD NAME="total_submissions" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="total_quiz_attempts" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="avg_assignment_score" TYPE="number" LENGTH="5" NOTNULL="false" SEQUENCE="false" DECIMALS="2"/>
        <FIELD NAME="avg_quiz_score" TYPE="number" LENGTH="5" NOTNULL="false" SEQUENCE="false" DECIMALS="2"/>
        <FIELD NAME="submission_rate" TYPE="number" LENGTH="5" NOTNULL="false" SEQUENCE="false" DECIMALS="2" COMMENT="Percentage"/>
        <FIELD NAME="avg_course_progress" TYPE="number" LENGTH="5" NOTNULL="false" SEQUENCE="false" DECIMALS="2"/>
        <FIELD NAME="completion_rate" TYPE="number" LENGTH="5" NOTNULL="false" SEQUENCE="false" DECIMALS="2" COMMENT="Percentage"/>
        <FIELD NAME="high_engagement_count" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Above 70th percentile"/>
        <FIELD NAME="medium_engagement_count" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="low_engagement_count" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Below 30th percentile"/>
        <FIELD NAME="at_risk_count" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="No activity for 7+ days"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="fk_schoolid" TYPE="foreign" FIELDS="schoolid" REFTABLE="elby_schools" REFFIELDS="id"/>
        <KEY NAME="uq_school_course_period" TYPE="unique" FIELDS="schoolid, courseid, period_start, period_type"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="idx_schoolid" UNIQUE="false" FIELDS="schoolid"/>
        <INDEX NAME="idx_courseid" UNIQUE="false" FIELDS="courseid"/>
        <INDEX NAME="idx_period_start" UNIQUE="false" FIELDS="period_start"/>
      </INDEXES>
    </TABLE>

    <TABLE NAME="elby_sync_log" COMMENT="Audit log for SDMS sync operations">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="sync_type" TYPE="char" LENGTH="50" NOTNULL="true" DEFAULT="" SEQUENCE="false" COMMENT="student, school, staff, metrics"/>
        <FIELD NAME="entity_id" TYPE="char" LENGTH="50" NOTNULL="false" SEQUENCE="false" COMMENT="SDMS ID or userid"/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Moodle user ID if applicable"/>
        <FIELD NAME="operation" TYPE="char" LENGTH="20" NOTNULL="true" DEFAULT="" SEQUENCE="false" COMMENT="create, update, skip, error"/>
        <FIELD NAME="request_url" TYPE="char" LENGTH="500" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="response_code" TYPE="int" LENGTH="5" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="response_time_ms" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="error_message" TYPE="text" NOTNULL="false" SEQUENCE="false"/>
        <FIELD NAME="details" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="JSON for debugging"/>
        <FIELD NAME="triggered_by" TYPE="char" LENGTH="50" NOTNULL="false" SEQUENCE="false" COMMENT="event, task, manual"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="idx_sync_type" UNIQUE="false" FIELDS="sync_type"/>
        <INDEX NAME="idx_entity_id" UNIQUE="false" FIELDS="entity_id"/>
        <INDEX NAME="idx_userid" UNIQUE="false" FIELDS="userid"/>
        <INDEX NAME="idx_operation" UNIQUE="false" FIELDS="operation"/>
        <INDEX NAME="idx_timecreated" UNIQUE="false" FIELDS="timecreated"/>
      </INDEXES>
    </TABLE>
  </TABLES>
</XMLDB>
